<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ü§ñ AI Task Management System - Live Demo</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 25px 50px rgba(0,0,0,0.15);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #4f46e5, #7c3aed);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            font-weight: 800;
        }

        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
        }

        .dashboard {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 20px;
            padding: 30px;
        }

        .card {
            background: #f8fafc;
            border-radius: 15px;
            padding: 25px;
            border: 2px solid #e2e8f0;
            transition: all 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(0,0,0,0.1);
            border-color: #4f46e5;
        }

        .card h3 {
            color: #1e293b;
            margin-bottom: 15px;
            font-size: 1.3rem;
            font-weight: 700;
        }

        .demo-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin: 20px 0;
        }

        .btn {
            background: linear-gradient(135deg, #4f46e5, #7c3aed);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(79, 70, 229, 0.3);
        }

        .btn.secondary {
            background: linear-gradient(135deg, #10b981, #059669);
        }

        .btn.warning {
            background: linear-gradient(135deg, #f59e0b, #d97706);
        }

        .results {
            background: #1e293b;
            color: white;
            border-radius: 15px;
            padding: 25px;
            margin: 20px 30px;
            font-family: 'Courier New', monospace;
            white-space: pre-wrap;
            max-height: 400px;
            overflow-y: auto;
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #4f46e5;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .status {
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 600;
            margin: 5px 0;
        }

        .status.success {
            background: #d1fae5;
            color: #065f46;
        }

        .status.warning {
            background: #fef3c7;
            color: #92400e;
        }

        .status.error {
            background: #fecaca;
            color: #991b1b;
        }

        .task-item {
            background: #f1f5f9;
            border-radius: 10px;
            padding: 15px;
            margin: 10px 0;
            border-left: 4px solid #4f46e5;
        }

        .task-priority {
            font-weight: bold;
            text-transform: uppercase;
            font-size: 0.8rem;
        }

        .priority-urgent { color: #dc2626; }
        .priority-high { color: #ea580c; }
        .priority-medium { color: #ca8a04; }
        .priority-low { color: #16a34a; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ü§ñ AI Task Management System</h1>
            <p>Automated Task Creation ‚Ä¢ Smart Assignments ‚Ä¢ Revenue Protection</p>
        </div>

        <div class="dashboard">
            <div class="card">
                <h3>üéØ Auto-Generate Tasks</h3>
                <p>AI analyzes business data and automatically creates intelligent tasks</p>
                <div class="demo-buttons">
                    <button class="btn" onclick="generateTasks()">Generate Tasks</button>
                    <button class="btn secondary" onclick="getTaskPerformance()">View Performance</button>
                </div>
                <div id="task-status"></div>
            </div>

            <div class="card">
                <h3>üìä Business Intelligence</h3>
                <p>Enhanced AI chat with task management integration</p>
                <div class="demo-buttons">
                    <button class="btn" onclick="askAI('What tasks do I need to complete today?')">Today's Tasks</button>
                    <button class="btn secondary" onclick="askAI('Generate tasks for quotation follow-ups')">Quotation Tasks</button>
                </div>
            </div>

            <div class="card">
                <h3>‚ö° Task Updates</h3>
                <p>Update task status and track completion</p>
                <div class="demo-buttons">
                    <button class="btn warning" onclick="getEmployeeTasks()">My Tasks</button>
                    <button class="btn secondary" onclick="testTaskUpdate()">Update Task</button>
                </div>
            </div>
        </div>

        <div class="results" id="results">
üöÄ AI Task Management System Ready!

Features Available:
‚úÖ Automated task creation based on business rules
‚úÖ Smart team member assignment
‚úÖ Priority calculation and scheduling  
‚úÖ Revenue impact tracking
‚úÖ Intelligent reminders and notifications
‚úÖ Performance analytics and insights

Click any button above to test the system...
        </div>
    </div>

    <script>
        // Dynamically get the current host and port
        const API_BASE = `${window.location.protocol}//${window.location.host}/api`;
        
        function log(message, type = 'info') {
            const results = document.getElementById('results');
            const timestamp = new Date().toLocaleTimeString();
            const icon = type === 'success' ? '‚úÖ' : type === 'error' ? '‚ùå' : type === 'warning' ? '‚ö†Ô∏è' : '‚ÑπÔ∏è';
            
            results.textContent += `\n[${timestamp}] ${icon} ${message}`;
            results.scrollTop = results.scrollHeight;
        }

        function showLoading(element) {
            element.innerHTML = '<div class="loading"></div> Processing...';
        }

        async function generateTasks() {
            const statusEl = document.getElementById('task-status');
            showLoading(statusEl);
            
            log('ü§ñ Starting AI task generation...', 'info');
            
            try {
                const response = await fetch(`${API_BASE}/ai-tasks/generate`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' }
                });
                
                const data = await response.json();
                
                if (data.success) {
                    log(`üéØ SUCCESS: Generated ${data.tasksCreated} intelligent tasks`, 'success');
                    
                    if (data.tasks && data.tasks.length > 0) {
                        log('üìã Generated Tasks:', 'info');
                        data.tasks.forEach(task => {
                            log(`  ‚Ä¢ ${task.title} (${task.priority}) - Due: ${new Date(task.due_date).toLocaleDateString()}`, 'info');
                            log(`    üìà Impact: ${task.business_impact} | ü§ñ Reasoning: ${task.ai_reasoning}`, 'info');
                        });
                    }
                    
                    statusEl.innerHTML = `<div class="status success">‚úÖ ${data.tasksCreated} tasks created</div>`;
                } else {
                    log(`‚ùå Task generation failed: ${data.error}`, 'error');
                    statusEl.innerHTML = `<div class="status error">‚ùå Generation failed</div>`;
                }
            } catch (error) {
                log(`‚ùå Network error: ${error.message}`, 'error');
                statusEl.innerHTML = `<div class="status error">‚ùå Network error</div>`;
            }
        }

        async function getTaskPerformance() {
            log('üìä Fetching task performance analytics...', 'info');
            
            try {
                const response = await fetch(`${API_BASE}/ai-tasks/generate`);
                const data = await response.json();
                
                if (data.success && data.performance_analytics) {
                    log('üìà TASK PERFORMANCE ANALYTICS:', 'success');
                    data.performance_analytics.forEach(perf => {
                        log(`  üë§ ${perf.employee_name}:`, 'info');
                        log(`     üìù Total Tasks: ${perf.total_tasks}`, 'info');
                        log(`     ‚úÖ Completed: ${perf.completed_tasks} (${(perf.completion_rate * 100).toFixed(1)}%)`, 'info');
                        log(`     ‚è∞ Overdue: ${perf.overdue_tasks}`, 'info');
                        log(`     üí∞ Revenue Impact: ‚Çπ${perf.revenue_impact.toLocaleString()}`, 'info');
                    });
                } else {
                    log('üìä No performance data available yet', 'warning');
                }
            } catch (error) {
                log(`‚ùå Performance fetch error: ${error.message}`, 'error');
            }
        }

        async function askAI(message) {
            log(`ü§ñ Asking AI: "${message}"`, 'info');
            
            try {
                const response = await fetch(`${API_BASE}/ai-chat`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ message })
                });
                
                const data = await response.json();
                
                if (data.message) {
                    log('ü§ñ AI RESPONSE:', 'success');
                    log(data.message, 'info');
                    
                    if (data.taskCreation && data.taskCreation.tasksCreated > 0) {
                        log(`üéØ BONUS: AI automatically created ${data.taskCreation.tasksCreated} new tasks!`, 'success');
                    }
                    
                    if (data.businessData?.taskManagement) {
                        const tm = data.businessData.taskManagement;
                        log(`üìä CURRENT TASK STATUS:`, 'info');
                        log(`   Active: ${tm.totalActiveTasks} | Completed: ${tm.completedTasks} | Overdue: ${tm.overdueTasks}`, 'info');
                        log(`   Completion Rate: ${(tm.taskCompletionRate * 100).toFixed(1)}%`, 'info');
                    }
                } else {
                    log(`‚ùå AI chat error: ${data.error}`, 'error');
                }
            } catch (error) {
                log(`‚ùå AI chat network error: ${error.message}`, 'error');
            }
        }

        async function getEmployeeTasks() {
            log('üìã Fetching employee tasks (simulated for Employee ID 1)...', 'info');
            
            try {
                const response = await fetch(`${API_BASE}/ai-tasks/generate?employeeId=1`);
                const data = await response.json();
                
                if (data.success && data.tasks) {
                    log(`üìù TASKS FOR EMPLOYEE:`, 'success');
                    
                    if (data.tasks.length === 0) {
                        log('   No tasks assigned yet', 'warning');
                        log('   üí° Try generating tasks first!', 'info');
                    } else {
                        data.tasks.forEach(task => {
                            const priorityClass = `priority-${task.priority}`;
                            log(`   üéØ ${task.title}`, 'info');
                            log(`      Priority: ${task.priority.toUpperCase()} | Status: ${task.status}`, 'info');
                            log(`      Due: ${new Date(task.due_date).toLocaleDateString()}`, 'info');
                            log(`      Client: ${task.client_name || 'N/A'} | Value: ‚Çπ${(task.estimated_value || 0).toLocaleString()}`, 'info');
                        });
                    }
                } else {
                    log('üìã No employee tasks found', 'warning');
                }
            } catch (error) {
                log(`‚ùå Employee tasks error: ${error.message}`, 'error');
            }
        }

        async function testTaskUpdate() {
            log('üîÑ Testing task update functionality...', 'info');
            log('üí° This would normally update a specific task status', 'warning');
            log('üìù Example: Update task ABC123 to "completed" with notes', 'info');
            
            // Simulated task update
            const fakeTaskId = 'demo-task-' + Date.now();
            log(`üéØ Simulating update for task: ${fakeTaskId}`, 'info');
            log('‚úÖ Task marked as completed!', 'success');
            log('üìä Performance metrics updated', 'info');
            log('üîî Team notifications sent', 'info');
        }

        // Auto-test on page load
        setTimeout(() => {
            log('üéâ Ready to test AI Task Management System!', 'success');
            log(`üîó API Base URL: ${API_BASE}`, 'info');
            log('üí° Click "Generate Tasks" to create intelligent tasks automatically', 'info');
            log('ü§ñ Ask AI questions about your tasks and business', 'info');
            
            // Test API connectivity
            testAPIConnection();
        }, 1000);
        
        async function testAPIConnection() {
            try {
                log('üîç Testing API connection...', 'info');
                const response = await fetch(`${API_BASE}/ai-chat/test`);
                const data = await response.json();
                
                if (data.success) {
                    log('‚úÖ API connection successful!', 'success');
                    log(`üîß LLM Status: ${data.results?.environment?.status || 'Unknown'}`, 'info');
                } else {
                    log('‚ö†Ô∏è API connected but with issues', 'warning');
                }
            } catch (error) {
                log(`‚ùå API connection failed: ${error.message}`, 'error');
                log('üí° Make sure the Next.js server is running', 'warning');
            }
        }
    </script>
</body>
</html> 